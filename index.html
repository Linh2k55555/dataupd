<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>L∆∞u tr·ªØ d·ªØ li·ªáu UPD</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f4f6f8; }
    h1 { font-size: 22px; text-align: center; margin-bottom: 20px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
    .card { background: white; border-radius: 12px; padding: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: 0.3s; }
    .card:hover { transform: translateY(-3px); }
    img { width: 100%; border-radius: 8px; }
    textarea { width: 100%; margin-top: 8px; font-size: 12px; border: 1px solid #ccc; border-radius: 6px; padding: 4px; resize: none; }
    button { margin-top: 6px; padding: 6px 10px; font-size: 12px; cursor: pointer; border: none; border-radius: 6px; background: #4CAF50; color: white; }
    button:hover { background: #43a047; }
  </style>
</head>
<body>
  <h1>üìÇ L∆∞u tr·ªØ d·ªØ li·ªáu UPD</h1>
  <input type="file" accept="image/*" id="upload" />
  <div id="images" class="grid"></div>

  <script>
    const GITHUB_USER = "Linh2k55555";
    const REPO = "dataupd";   // repo b·∫°n ƒëang d√πng
    const FILE_PATH = "images.json";
    const BRANCH = "main";
    const TOKEN = "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"; // ‚ö†Ô∏è th√™m token c·ªßa b·∫°n ·ªü ƒë√¢y

    const imagesContainer = document.getElementById("images");
    let images = [];

    // Load images.json
    async function loadImages() {
      try {
        const res = await fetch(`https://raw.githubusercontent.com/${GITHUB_USER}/${REPO}/${BRANCH}/${FILE_PATH}`);
        images = await res.json();
      } catch {
        images = [];
      }
      renderImages();
    }

    function renderImages() {
      imagesContainer.innerHTML = "";
      images.forEach((link, i) => {
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `
          <img src="${link}" alt="uploaded-${i}">
          <textarea readonly rows="2">${link}</textarea>
          <button onclick="copyLink('${link}')">Sao ch√©p link</button>
          <button onclick="window.open('${link}', '_blank')">M·ªü ·∫£nh</button>
        `;
        imagesContainer.appendChild(div);
      });
    }

    async function handleUpload(e) {
      const file = e.target.files[0];
      if (!file) return;

      const fileName = `${Date.now()}-${file.name}`;
      const path = `images/${fileName}`;

      // ƒê·ªçc file th√†nh base64
      const reader = new FileReader();
      reader.onloadend = async () => {
        const base64 = reader.result.split(",")[1];

        // Upload file ·∫£nh v√†o repo
        const uploadRes = await fetch(`https://api.github.com/repos/${GITHUB_USER}/${REPO}/contents/${path}`, {
          method: "PUT",
          headers: {
            Authorization: `token ${TOKEN}`,
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            message: `Upload ${fileName}`,
            content: base64,
            branch: BRANCH,
          }),
        });

        if (!uploadRes.ok) {
          alert("‚ùå Upload th·∫•t b·∫°i!");
          return;
        }

        // T·∫°o link raw auto
        const rawLink = `https://raw.githubusercontent.com/${GITHUB_USER}/${REPO}/${BRANCH}/${path}`;
        const newImages = [...images, rawLink];

        // L·∫•y SHA c·ªßa file images.json (n·∫øu c√≥)
        let sha = null;
        try {
          const res = await fetch(
            `https://api.github.com/repos/${GITHUB_USER}/${REPO}/contents/${FILE_PATH}`,
            { headers: { Authorization: `token ${TOKEN}` } }
          );
          if (res.ok) {
            const fileData = await res.json();
            sha = fileData.sha;
          }
        } catch {}

        // Update images.json
        await fetch(
          `https://api.github.com/repos/${GITHUB_USER}/${REPO}/contents/${FILE_PATH}`,
          {
            method: "PUT",
            headers: {
              Authorization: `token ${TOKEN}`,
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              message: "Update images.json",
              content: btoa(JSON.stringify(newImages, null, 2)),
              sha,
              branch: BRANCH,
            }),
          }
        );

        images = newImages;
        renderImages();
      };
      reader.readAsDataURL(file);
    }

    function copyLink(link) {
      navigator.clipboard.writeText(link).then(() => {
        alert("üìã ƒê√£ sao ch√©p link!");
      });
    }

    document.getElementById("upload").addEventListener("change", handleUpload);

    loadImages();
  </script>
</body>
</html>
